<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Perfect Fit — Web Viz</title>
  <style>
    body { font-family: system-ui, Arial, sans-serif; margin: 20px; }
    #board { border: 1px solid #999; image-rendering: pixelated; }
    .controls { margin-top: 12px; display: flex; gap: 12px; align-items: center; }
    .legend { font-size: 0.9em; color: #555; }
  </style>
</head>
<body>
  <h1>Perfect Fit — Web Visualizer</h1>
  <p class="legend">Load <code>solution.json</code> (generated by <code>python -m perfect_fit.export_solution --board ... --out viz/solution.json</code>)</p>
  <canvas id="board" width="640" height="640"></canvas>
  <div class="controls">
    <input type="file" id="file" accept="application/json">
    <button id="stepBack">⟵</button>
    <input type="range" id="slider" min="0" max="0" value="0" style="width: 300px;">
    <button id="stepFwd">⟶</button>
    <span id="status"></span>
  </div>
  <script>
    const canvas = document.getElementById('board');
    const ctx = canvas.getContext('2d');
    let data = null;
    let step = 0;
    const cellSize = 28;
    function drawEmpty(W,H){
      canvas.width = W*cellSize + 1;
      canvas.height = H*cellSize + 1;
      ctx.clearRect(0,0,canvas.width,canvas.height);
      ctx.strokeStyle = '#ccc';
      for(let r=0;r<=H;r++){
        ctx.beginPath(); ctx.moveTo(0, r*cellSize); ctx.lineTo(W*cellSize, r*cellSize); ctx.stroke();
      }
      for(let c=0;c<=W;c++){
        ctx.beginPath(); ctx.moveTo(c*cellSize, 0); ctx.lineTo(c*cellSize, H*cellSize); ctx.stroke();
      }
    }
    function randColor(i){
      // deterministic pastel-ish color by index
      const hue = (i*47) % 360;
      return `hsl(${hue} 70% 70%)`;
    }
    function drawStep(){
      const W = data.meta.W, H = data.meta.H;
      drawEmpty(W,H);
      for(let i=0;i<step;i++){
        const fr = data.frames[i];
        ctx.fillStyle = randColor(i);
        fr.cells.forEach(c=>{
          ctx.fillRect(c.c*cellSize+1, c.r*cellSize+1, cellSize-1, cellSize-1);
        });
      }
      document.getElementById('status').textContent = `Step ${step}/${data.frames.length}`;
    }
    function setStep(s){
      step = Math.max(0, Math.min(s, data?data.frames.length:0));
      document.getElementById('slider').value = step;
      drawStep();
    }
    document.getElementById('file').addEventListener('change', (ev)=>{
      const f = ev.target.files[0];
      if(!f) return;
      const reader = new FileReader();
      reader.onload = ()=>{
        data = JSON.parse(reader.result);
        step = 0;
        const slider = document.getElementById('slider');
        slider.max = data.frames.length;
        slider.value = 0;
        drawEmpty(data.meta.W, data.meta.H);
        drawStep();
      };
      reader.readAsText(f);
    });
    document.getElementById('slider').addEventListener('input', (e)=>{
      if(!data) return;
      setStep(parseInt(e.target.value,10));
    });
    document.getElementById('stepBack').addEventListener('click', ()=>data && setStep(step-1));
    document.getElementById('stepFwd').addEventListener('click', ()=>data && setStep(step+1));
    // Default empty board
    drawEmpty(10,6);
  </script>
</body>
</html>